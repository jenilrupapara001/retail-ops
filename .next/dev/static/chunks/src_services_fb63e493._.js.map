{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jenilrupapara/Easysell%20Projects/GMS%20Report/gms-dashboard/src/services/db.js"],"sourcesContent":["// Database service for Revenue Calculator\n// Calls the backend API for all operations\n\nconst API_BASE = (typeof import.meta !== 'undefined' && (import.meta).env?.VITE_API_URL) || 'http://localhost:3001/api';\n\n/**\n * Initialize database connection\n */\nexport const initializeDatabase = async () => {\n  console.log('[DB] Remote mode: MongoDB backend via API');\n};\n\n/**\n * Database Service Class\n */\nclass DatabaseService {\n  /**\n   * Make API request\n   */\n  async request(path, options = {}, fallback = null) {\n    try {\n      const token = localStorage.getItem('authToken');\n      const headers = {\n        'Content-Type': 'application/json',\n        ...(token && { 'Authorization': `Bearer ${token}` }),\n        ...options.headers\n      };\n\n      const res = await fetch(`${API_BASE}${path}`, {\n        ...options,\n        headers,\n      });\n\n      if (!res.ok) {\n        if (res.status === 401) {\n          localStorage.removeItem('authToken');\n          window.location.href = '/login';\n        }\n        throw new Error(`HTTP ${res.status}`);\n      }\n      return await res.json();\n    } catch (error) {\n      console.error(`[DB] Request failed for ${path}:`, error);\n      return fallback;\n    }\n  }\n\n  // --- Auth & Config ---\n  async login(email, password) {\n    const user = await this.request(\n      '/auth/login',\n      { method: 'POST', body: JSON.stringify({ email, password }) },\n      null\n    );\n    if (user) {\n      localStorage.setItem('user', JSON.stringify(user));\n      return user;\n    }\n    return null;\n  }\n\n  logout() {\n    localStorage.removeItem('user');\n  }\n\n  getUser() {\n    const u = localStorage.getItem('user');\n    return u ? JSON.parse(u) : null;\n  }\n\n  getKeepaKey() {\n    return localStorage.getItem('fba_keepa_key') || '';\n  }\n\n  saveKeepaKey(key) {\n    localStorage.setItem('fba_keepa_key', key);\n  }\n\n  saveUser(user) {\n    const existing = this.getUser();\n    const merged = { ...(existing || {}), ...user };\n    localStorage.setItem('user', JSON.stringify(merged));\n  }\n\n  // --- Referral Fees ---\n\n  /**\n   * @returns {Promise<ReferralFee[]>}\n   */\n  async getReferralFees() {\n    return this.request('/fees/referral', {}, []);\n  }\n\n  /**\n   * @param {ReferralFee | Omit<ReferralFee, 'id'>} fee\n   */\n  async saveReferralFee(fee) {\n    const data = { ...fee, id: fee.id || crypto.randomUUID() };\n    await this.request('/fees/referral', { method: 'POST', body: JSON.stringify(data) }, null);\n  }\n\n  /**\n   * @param {Omit<ReferralFee, 'id'>[]} fees\n   */\n  async saveReferralFeesBulk(fees) {\n    for (const fee of fees) {\n      await this.saveReferralFee(fee);\n    }\n  }\n\n  async deleteReferralFee(id) {\n    await this.request(`/fees/referral/${id}`, { method: 'DELETE' }, null);\n  }\n\n  async clearReferralFees() {\n    await this.request('/fees/referral/all', { method: 'DELETE' }, null);\n  }\n\n  // --- Closing Fees ---\n\n  /**\n   * @returns {Promise<ClosingFee[]>}\n   */\n  async getClosingFees() {\n    return this.request('/fees/closing', {}, []);\n  }\n\n  /**\n   * @param {ClosingFee | Omit<ClosingFee, 'id'>} fee\n   */\n  async saveClosingFee(fee) {\n    const data = { ...fee, id: fee.id || crypto.randomUUID() };\n    await this.request('/fees/closing', { method: 'POST', body: JSON.stringify(data) }, null);\n  }\n\n  /**\n   * @param {Omit<ClosingFee, 'id'>[]} fees\n   */\n  async saveClosingFeesBulk(fees) {\n    for (const fee of fees) {\n      await this.saveClosingFee(fee);\n    }\n  }\n\n  async deleteClosingFee(id) {\n    await this.request(`/fees/closing/${id}`, { method: 'DELETE' }, null);\n  }\n\n  async clearClosingFees() {\n    await this.request('/fees/closing/all', { method: 'DELETE' }, null);\n  }\n\n  // --- Shipping Fees ---\n\n  /**\n   * @returns {Promise<ShippingFee[]>}\n   */\n  async getShippingFees() {\n    return this.request('/fees/shipping', {}, []);\n  }\n\n  /**\n   * @param {ShippingFee | Omit<ShippingFee, 'id'>} fee\n   */\n  async saveShippingFee(fee) {\n    const data = { ...fee, id: fee.id || crypto.randomUUID() };\n    await this.request('/fees/shipping', { method: 'POST', body: JSON.stringify(data) }, null);\n  }\n\n  /**\n   * @param {Omit<ShippingFee, 'id'>[]} fees\n   */\n  async saveShippingFeesBulk(fees) {\n    for (const fee of fees) {\n      await this.saveShippingFee(fee);\n    }\n  }\n\n  async deleteShippingFee(id) {\n    await this.request(`/fees/shipping/${id}`, { method: 'DELETE' }, null);\n  }\n\n  async clearShippingFees() {\n    await this.request('/fees/shipping/all', { method: 'DELETE' }, null);\n  }\n\n  // --- Storage Fees ---\n\n  /**\n   * @returns {Promise<StorageFee[]>}\n   */\n  async getStorageFees() {\n    return this.request('/fees/storage', {}, []);\n  }\n\n  /**\n   * @param {StorageFee | Omit<StorageFee, 'id'>} fee\n   */\n  async saveStorageFee(fee) {\n    const data = { ...fee, id: fee.id || crypto.randomUUID() };\n    await this.request('/fees/storage', { method: 'POST', body: JSON.stringify(data) }, null);\n  }\n\n  async deleteStorageFee(id) {\n    await this.request(`/fees/storage/${id}`, { method: 'DELETE' }, null);\n  }\n\n  // --- Category Mapping ---\n\n  /**\n   * @returns {Promise<CategoryMap[]>}\n   */\n  async getCategoryMappings() {\n    return this.request('/mappings', {}, []);\n  }\n\n  /**\n   * @param {CategoryMap | Omit<CategoryMap, 'id'>} map\n   */\n  async saveCategoryMapping(map) {\n    const data = { ...map, id: map.id || crypto.randomUUID() };\n    await this.request('/mappings', { method: 'POST', body: JSON.stringify(data) }, null);\n  }\n\n  async deleteCategoryMapping(id) {\n    await this.request(`/mappings/${id}`, { method: 'DELETE' }, null);\n  }\n\n  async clearCategoryMappings() {\n    await this.request('/mappings/all', { method: 'DELETE' }, null);\n  }\n\n  // --- Node Map ---\n\n  /**\n   * @returns {Promise<NodeMap[]>}\n   */\n  async getNodeMaps() {\n    return this.request('/nodemaps', {}, []);\n  }\n\n  /**\n   * @param {NodeMap | Omit<NodeMap, 'id'>} map\n   */\n  async saveNodeMap(map) {\n    const data = { ...map, id: map.id || crypto.randomUUID() };\n    await this.request('/nodemaps', { method: 'POST', body: JSON.stringify(data) }, null);\n  }\n\n  async deleteNodeMap(id) {\n    await this.request(`/nodemaps/${id}`, { method: 'DELETE' }, null);\n  }\n\n  async clearNodeMaps() {\n    await this.request('/nodemaps/all', { method: 'DELETE' }, null);\n  }\n\n  // --- ASINs ---\n\n  /**\n   * @returns {Promise<AsinItem[]>}\n   */\n  async getAsins(params = {}) {\n    return this.request('/asins', { params }, []);\n  }\n\n  /**\n   * @param {{ asin: string; stapleLevel: any }[]} items\n   */\n  async addAsinsBulk(items) {\n    const payload = items.map((item) => ({\n      ...item,\n      status: 'pending',\n      stepLevel: 'Standard',\n      createdAt: new Date().toISOString(),\n    }));\n    await this.request('/asins/bulk', { method: 'POST', body: JSON.stringify(payload) }, null);\n  }\n\n  async updateMissingStepLevels() {\n    const items = await this.getAsins();\n    const missing = items.filter((i) => !i.stepLevel);\n    for (const item of missing) {\n      await this.updateAsin(item.id, { stepLevel: 'Standard' });\n    }\n    return missing.length;\n  }\n\n  /**\n   * @param {string} id\n   * @param {Partial<AsinItem>} updates\n   */\n  async updateAsin(id, updates) {\n    await this.request(`/asins/${id}`, { method: 'PUT', body: JSON.stringify(updates) }, null);\n  }\n\n  async clearAsins() {\n    await this.request('/asins', { method: 'DELETE' }, null);\n  }\n\n  async deleteAsin(id) {\n    await this.request(`/asins/${id}`, { method: 'DELETE' }, null);\n  }\n\n  // --- Refund Fees ---\n\n  /**\n   * @returns {Promise<RefundFee[]>}\n   */\n  async getRefundFees() {\n    return this.request('/fees/refund', {}, []);\n  }\n\n  /**\n   * @param {RefundFee | Omit<RefundFee, 'id'>} fee\n   */\n  async saveRefundFee(fee) {\n    const data = { ...fee, id: fee.id || crypto.randomUUID() };\n    await this.request('/fees/refund', { method: 'POST', body: JSON.stringify(data) }, null);\n  }\n\n  async deleteRefundFee(id) {\n    await this.request(`/fees/refund/${id}`, { method: 'DELETE' }, null);\n  }\n\n  async clearRefundFees() {\n    await this.request('/fees/refund/all', { method: 'DELETE' }, null);\n  }\n\n  // --- Calculation ---\n  async calculateProfits(asinIds = []) {\n    await this.request('/revenue/calculate', { method: 'POST', body: JSON.stringify({ asinIds }) }, null);\n  }\n\n\n  // --- ASINs ---\n\n  /**\n   * Get all ASINs\n   * @returns {Promise<ASIN[]>}\n   */\n  async getAsins(params = {}) {\n    return this.request('/asins', { params }, []);\n  }\n\n  /**\n   * Get single ASIN\n   * @param {string} id\n   * @returns {Promise<ASIN>}\n   */\n  async getAsin(id) {\n    return this.request(`/asins/${id}`, {}, null);\n  }\n\n  /**\n   * Create or Update ASIN\n   * @param {Partial<ASIN>} asin\n   */\n  async saveAsin(asin) {\n    if (asin.id || asin._id) {\n      const id = asin.id || asin._id;\n      return this.request(`/asins/${id}`, { method: 'PUT', body: JSON.stringify(asin) }, null);\n    } else {\n      return this.request('/asins', { method: 'POST', body: JSON.stringify(asin) }, null);\n    }\n  }\n\n  /**\n   * Delete ASIN\n   * @param {string} id\n   */\n  async deleteAsin(id) {\n    return this.request(`/asins/${id}`, { method: 'DELETE' }, null);\n  }\n\n  // --- Actions ---\n\n  /**\n   * Get all actions\n   * @returns {Promise<Action[]>}\n   */\n  async getActions() {\n    return this.request('/actions', {}, []);\n  }\n\n  /**\n   * Create a new action\n   * @param {Partial<Action>} action\n   */\n  async createAction(action) {\n    return this.request('/actions', { method: 'POST', body: JSON.stringify(action) }, null);\n  }\n\n  /**\n   * Update an action\n   * @param {string} id\n   * @param {Partial<Action>} updates\n   */\n  async updateAction(id, updates) {\n    return this.request(`/actions/${id}`, { method: 'PUT', body: JSON.stringify(updates) }, null);\n  }\n\n  /**\n   * Delete an action\n   * @param {string} id\n   */\n  async deleteAction(id) {\n    return this.request(`/actions/${id}`, { method: 'DELETE' }, null);\n  }\n\n  /**\n   * Add a message to an action\n   * @param {string} actionId\n   * @param {string} content\n   */\n  async addMessage(actionId, content) {\n    return this.request(`/actions/${actionId}/messages`, { method: 'POST', body: JSON.stringify({ content }) }, null);\n  }\n\n  /**\n   * Get all users (for assignment)\n   * @returns {Promise<User[]>}\n   */\n  async getUsers() {\n    return this.request('/users', {}, []);\n  }\n\n  /**\n   * Get all sellers\n   * @returns {Promise<Seller[]>}\n   */\n  async getSellers() {\n    return this.request('/sellers', {}, []);\n  }\n\n  // --- NEW: Workflow Actions ---\n\n  /**\n   * Start a task\n   * @param {string} actionId\n   */\n  async startAction(actionId) {\n    return this.request(`/actions/${actionId}/start`, { method: 'POST' }, null);\n  }\n\n  /**\n   * Complete a task\n   * @param {string} actionId\n   * @param {object} completionData - { remarks, stage, recurring, audioTranscript }\n   */\n  async completeAction(actionId, completionData) {\n    return this.request(`/actions/${actionId}/complete`, {\n      method: 'POST',\n      body: JSON.stringify(completionData)\n    }, null);\n  }\n\n  /**\n   * Upload audio for task completion\n   * @param {string} actionId\n   * @param {Blob} audioBlob\n   * @param {string} transcript\n   */\n  async uploadAudio(actionId, audioBlob, transcript) {\n    const formData = new FormData();\n    formData.append('audio', audioBlob, 'recording.webm');\n    if (transcript) {\n      formData.append('transcript', transcript);\n    }\n\n    try {\n      const res = await fetch(`${API_BASE}/actions/${actionId}/upload-audio`, {\n        method: 'POST',\n        body: formData,\n      });\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      return await res.json();\n    } catch (error) {\n      console.error(`[DB] Audio upload failed:`, error);\n      return null;\n    }\n  }\n\n  /**\n   * Get action history (stage transitions)\n   * @param {string} actionId\n   */\n  async getActionHistory(actionId) {\n    return this.request(`/actions/${actionId}/history`, {}, null);\n  }\n\n  /**\n   * Analyze ASIN and get suggested actions\n   * @param {string} asinId\n   */\n  async analyzeAsin(asinId) {\n    return this.request(`/actions/analyze-asin/${asinId}`, { method: 'POST' }, null);\n  }\n\n  /**\n   * Create actions from ASIN analysis\n   * @param {string} asinId\n   */\n  async createActionsFromAnalysis(asinId) {\n    return this.request(`/actions/create-from-analysis/${asinId}`, { method: 'POST' }, null);\n  }\n\n  /**\n   * Get overdue actions\n   */\n  async getOverdueActions() {\n    return this.request('/actions/reports/overdue', {}, []);\n  }\n\n  /**\n   * Get Goal vs Achievement report\n   */\n  async getGoalAchievementReport() {\n    return this.request('/actions/reports/goal-achievement', {}, null);\n  }\n\n  // --- Action Review Workflow ---\n\n  async startAction(id) {\n    return this.request(`/actions/${id}/start`, { method: 'POST' }, null);\n  }\n\n  async submitActionForReview(id, formData) {\n    // Check if formData is instance of FormData (for audio uploads)\n    const isFormData = formData instanceof FormData;\n\n    const options = {\n      method: 'POST',\n      body: isFormData ? formData : JSON.stringify(formData)\n    };\n\n    // If it's FormData, let the browser set the boundary header\n    if (isFormData) {\n      const token = localStorage.getItem('authToken');\n      options.headers = {\n        ...(token && { 'Authorization': `Bearer ${token}` })\n      };\n      // Important: Remove default Content-Type to let fetch set it with boundary\n      return fetch(`${API_BASE}/actions/${id}/submit-review`, options)\n        .then(res => res.json())\n        .catch(err => {\n          console.error('[DB] Submit for review failed:', err);\n          return null;\n        });\n    }\n\n    return this.request(`/actions/${id}/submit-review`, options, null);\n  }\n\n  async reviewAction(id, decision, comments) {\n    return this.request(`/actions/${id}/review-action`, {\n      method: 'POST',\n      body: JSON.stringify({ decision, comments })\n    }, null);\n  }\n\n  // --- OKR Methods ---\n\n  /**\n   * Get all objectives\n   */\n  async getObjectives() {\n    return this.request('/objectives', {}, []);\n  }\n\n  /**\n   * Get all task templates\n   */\n  async getTaskTemplates() {\n    return this.request('/actions/templates', {}, []);\n  }\n\n  /**\n   * Create a new task template\n   * @param {object} template\n   */\n  async createTemplate(template) {\n    return this.request('/actions/templates', { method: 'POST', body: JSON.stringify(template) }, null);\n  }\n\n  /**\n   * Update a task template\n   * @param {string} id\n   * @param {object} updates\n   */\n  async updateTemplate(id, updates) {\n    return this.request(`/actions/templates/${id}`, { method: 'PUT', body: JSON.stringify(updates) }, null);\n  }\n\n  /**\n   * Delete a task template\n   * @param {string} id\n   */\n  async deleteTemplate(id) {\n    return this.request(`/actions/templates/${id}`, { method: 'DELETE' }, null);\n  }\n\n  /**\n   * Create a new objective\n   * @param {object} objective\n   */\n  async createObjective(objective) {\n    return this.request('/objectives', { method: 'POST', body: JSON.stringify(objective) }, null);\n  }\n\n  /**\n   * Create a new key result\n   * @param {object} keyResult\n   */\n  async createKeyResult(keyResult) {\n    return this.request('/objectives/key-results', { method: 'POST', body: JSON.stringify(keyResult) }, null);\n  }\n\n  /**\n   * Update an objective\n   */\n  async updateObjective(id, objective) {\n    return this.request(`/objectives/${id}`, { method: 'PUT', body: JSON.stringify(objective) }, null);\n  }\n\n  /**\n   * Delete an objective\n   */\n  async deleteObjective(id) {\n    return this.request(`/objectives/${id}`, { method: 'DELETE' }, null);\n  }\n\n  /**\n   * Update a key result\n   */\n  async updateKeyResult(id, keyResult) {\n    return this.request(`/objectives/key-results/${id}`, { method: 'PUT', body: JSON.stringify(keyResult) }, null);\n  }\n\n  /**\n   * Delete a key result\n   */\n  async deleteKeyResult(id) {\n    return this.request(`/objectives/key-results/${id}`, { method: 'DELETE' }, null);\n  }\n\n  // --- AI Methods ---\n\n  /**\n   * Generate OKR structure using AI\n   * @param {object} params - { prompt, type, industry }\n   */\n  async generateAIOKR(params) {\n    return this.request('/ai/generate-okr', { method: 'POST', body: JSON.stringify(params) }, null);\n  }\n\n  /**\n   * Get AI suggestions for tasks\n   * @param {string} context - Goal or KR context\n   */\n  /**\n   * Get AI suggestions for tasks\n   * @param {string} context - Goal or KR context\n   */\n  async getAISuggestions(context) {\n    return this.request('/ai/suggest-tasks', { method: 'POST', body: JSON.stringify({ context }) }, null);\n  }\n\n  /**\n   * Get all system settings\n   * @param {string} group - Optional group to filter by\n   */\n  async getSettings(group) {\n    const data = await this.request(`/settings${group ? `?group=${group}` : ''}`, {}, { success: true, data: {} });\n    return data.data;\n  }\n\n  /**\n   * Update system settings\n   * @param {object} settings - Key-value pair of settings\n   * @param {string} group - Group name\n   */\n  async updateSettings(settings, group = 'general') {\n    return this.request('/settings/update', {\n      method: 'POST',\n      body: JSON.stringify({ settings, group })\n    }, null);\n  }\n\n  /**\n   * Get setting by key\n   * @param {string} key\n   */\n  async getSettingByKey(key) {\n    const data = await this.request(`/settings/${key}`, {}, { success: true, data: null });\n    return data.data;\n  }\n\n  /**\n   * Get system activity logs\n   */\n  async getSystemLogs() {\n    return this.request('/logs', { method: 'GET' }, null);\n  }\n}\n\nexport const db = new DatabaseService();\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 731, "column": 0}, "map": {"version":3,"sources":["file:///Users/jenilrupapara/Easysell%20Projects/GMS%20Report/gms-dashboard/src/services/engine.js"],"sourcesContent":["// Profit calculation engine for Revenue Calculator\n// Refactored to use backend API\nimport { db } from './db';\n\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\n/**\n * Fetch Keepa data for ASINs\n * @param {AsinItem[]} asins\n * @param {boolean} [forceRefresh=false]\n */\nexport const fetchKeepaData = async (asins, forceRefresh = false) => {\n  // Keeping fetchKeepaData client-side for now as it uses the user's local API key\n  // This logic is complex but works well client-side to avoid sharing API keys with server if privacy is concern\n  // Or we can move this to backend later if we want centralized key management\n\n  const targets = forceRefresh\n    ? asins\n    : asins.filter(a => a.status === 'pending' || a.status === 'error');\n\n  if (targets.length === 0) return;\n\n  const apiKey = db.getKeepaKey().trim();\n  if (!apiKey) {\n    console.warn(\"Skipping Keepa Fetch: Missing API Key.\");\n    return;\n  }\n\n  const chunkSize = 100;\n  for (let i = 0; i < targets.length; i += chunkSize) {\n    const chunk = targets.slice(i, i + chunkSize);\n    const validAsins = chunk.map(a => a.asin.trim()).filter(a => /^[A-Z0-9]{10}$/i.test(a));\n\n    if (validAsins.length === 0) {\n      for (const item of chunk) await db.updateAsin(item.id, { status: 'error', errorMessage: 'Invalid ASIN format' });\n      continue;\n    }\n\n    const asinList = validAsins.join(',');\n    let attempts = 0;\n    const maxAttempts = 5;\n    let success = false;\n\n    console.log(`[Keepa] Fetching chunk ${i / chunkSize + 1} (${validAsins.length} items): ${asinList}`);\n\n    while (attempts < maxAttempts && !success) {\n      try {\n        const url = `https://api.keepa.com/product?key=${apiKey}&domain=10&asin=${asinList}&stats=1&history=0&offersSuccessful=1`;\n        const response = await fetch(url, { method: 'GET', headers: { 'Accept': 'application/json' } });\n\n        if (response.status === 429) {\n          attempts++;\n          const waitTime = 5000 * Math.pow(2, attempts);\n          await delay(waitTime);\n          continue;\n        }\n\n        if (!response.ok) throw new Error(`API Error: ${response.status}`);\n        const textResponse = await response.text();\n        const data = JSON.parse(textResponse);\n\n        if (data.error) {\n          if (data.error.message && data.error.message.toLowerCase().includes('token')) {\n            attempts++;\n            const waitTime = 5000 * Math.pow(2, attempts);\n            await delay(waitTime);\n            continue;\n          }\n          throw new Error(data.error.message);\n        }\n\n        const products = data.products || [];\n        for (const item of chunk) {\n          const product = products.find(p => p.asin.toUpperCase() === item.asin.toUpperCase());\n\n          if (product) {\n            let rawPrice = -1;\n            const stats = product.stats;\n            if (stats && stats.current) {\n              const buyBox = stats.buyBoxPrice;\n              const newPrice = stats.current[1];\n              const amazonPrice = stats.current[0];\n              if (typeof buyBox === 'number' && buyBox > 0) rawPrice = buyBox;\n              else if (typeof newPrice === 'number' && newPrice > 0) rawPrice = newPrice;\n              else if (typeof amazonPrice === 'number' && amazonPrice > 0) rawPrice = amazonPrice;\n            }\n\n            const price = rawPrice > 0 ? rawPrice / 100 : 0;\n\n            const itemWeight = product.itemWeight || 0;\n            const packageWeight = product.packageWeight || 0;\n\n            const l = product.packageLength || 0;\n            const w = product.packageWidth || 0;\n            const h = product.packageHeight || 0;\n            const lCm = l / 10;\n            const wCm = w / 10;\n            const hCm = h / 10;\n            const volumetricWeight = Math.round((lCm * wCm * hCm) / 5000);\n\n            let finalWeight = 0;\n            if (packageWeight > 0) finalWeight = packageWeight;\n            else finalWeight = volumetricWeight;\n\n            const title = product.title || `ASIN ${item.asin}`;\n            const brand = product.brand || 'Unknown';\n            const image = product.imagesCSV ? `https://images-na.ssl-images-amazon.com/images/I/${product.imagesCSV.split(',')[0]}` : '';\n\n            let category = 'Uncategorized';\n            let categoryPath = '';\n            let categoryId = '';\n\n            if (product.categoryTree && product.categoryTree.length > 0) {\n              const leaf = product.categoryTree[product.categoryTree.length - 1];\n              category = leaf.name;\n              categoryPath = product.categoryTree.map(c => c.name).join(' > ');\n              categoryId = String(leaf.catId);\n            } else if (product.categories && product.categories.length > 0) {\n              categoryId = String(product.categories[product.categories.length - 1]);\n            }\n\n            await db.updateAsin(item.id, {\n              title, brand, category, categoryPath, categoryId, image, price,\n              weight: finalWeight, volumetricWeight,\n              dimensions: `${lCm.toFixed(1)}x${wCm.toFixed(1)}x${hCm.toFixed(1)} cm`,\n              status: 'fetched'\n            });\n          } else {\n            await db.updateAsin(item.id, { status: 'error', errorMessage: 'ASIN not found in Keepa return data' });\n          }\n        }\n        success = true;\n      } catch (error) {\n        if (error.message.includes('403') || error.message.includes('key')) {\n          for (const item of chunk) await db.updateAsin(item.id, { status: 'error', errorMessage: 'Invalid API Key' });\n          return;\n        }\n        attempts++;\n        await delay(5000);\n        if (attempts >= maxAttempts) {\n          for (const item of chunk) await db.updateAsin(item.id, { status: 'error', errorMessage: error.message });\n        }\n      }\n    }\n    await delay(2000);\n  }\n};\n\n/**\n * Calculate profits for ASINs by calling backend API\n * @param {AsinItem[]} asins\n */\nexport const calculateProfits = async (asins) => {\n  try {\n    console.log('[FeeCalc] Triggering backend calculation...');\n    // If asins array provided, pass IDs, otherwise empty array triggers all\n    const ids = asins ? asins.map(a => a.id).filter(Boolean) : [];\n    await db.calculateProfits(ids);\n    console.log('[FeeCalc] Backend calculation initiated');\n  } catch (error) {\n    console.error('[FeeCalc] Calculation error:', error);\n    throw error;\n  }\n};\n"],"names":[],"mappings":"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"}}]
}